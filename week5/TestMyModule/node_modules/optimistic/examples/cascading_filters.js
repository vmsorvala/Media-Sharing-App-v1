var Optimistic = require('../index.js');

var names = new Optimistic(['anna', 'barry', 'caleb', 'ariele', 'bob', 'amanda', 'aaron', 'amalie', 'bert', 'ellen']);

// filter out all that start with 'a'
var update_filter_a = names.pushUpdate(function(names) {
  names.filterNot(function(name) {
    return name[0] == 'a'; 
  });
});

// filter out all that start with 'b'
var update_filter_b = names.pushUpdate(function(names) {
  names.filterNot(function(name) {
    return name[0] == 'b';
  });
});

// Both updates applied optimistically
console.log(names.value);

setTimeout(function() {
  // A has succeeded, but B is still pending
  update_filter_a.succeeded();
}, 50); // play with the time on these timeouts!

setTimeout(function() {
  update_filter_b.failed();
}, 60);

setTimeout(function() {
  // A's are all removed, but B's roll back.  It's still all in order though!
  console.log(names.value);
}, 70);
